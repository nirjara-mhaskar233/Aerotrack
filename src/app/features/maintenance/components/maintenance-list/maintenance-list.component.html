<div class="toolbar">
  <div class="search-filters">
    <input
      class="input"
      type="text"
      placeholder="Search by TaskID or AircraftID"
      [(ngModel)]="term"
      (input)="refresh()"
    />

    <select [(ngModel)]="filterStatus" (change)="refresh()">
      <option value="">All Status</option>
      <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
    </select>
  </div>

  <div style="display: flex; gap: 8px; align-content: center">

<a
  class="btn btn-outline-secondary"
  routerLink="/maintenance/new"
  style="
    display:inline-flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    width:110px;
    height:64px;
    text-align:center;
    padding:0;
  "
>
  <span style="line-height:1.1;font-size: 14px;">+ New</span>
  <span style="line-height:1.1 ;font-size: 14px ">Task</span>
</a>


    
        <select class="form-select form-select-sm" [(ngModel)]="selectedAircraftForEmergency" style="min-width:180px;">
        <option value="">Select AircraftID</option>
        <option *ngFor="let id of aircraftIDs" [value]="id">{{ id }}</option>
        </select>


<button
  class="btn btn-danger"
  (click)="createEmergency()"
  style="
    width: 110px;
    height: 64px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 13px;
  "
>
  Create Emergency Task
</button>

  </div>
</div>

<table>
  <div class="card">
    <table class="table">
      <thead>
        <tr>
          <th>Task ID</th>
          <th>Aircraft ID</th>
          <th>Scheduled Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let t of tasks" [class.row-emergency]="t.isEmergency">
          <td>
            <span *ngIf="t.isEmergency" class="emg-icon" aria-label="Emergency"
              >⚠️</span
            >
            {{ t.taskID }}
          </td>

          <td>{{ t.aircraftID }}</td>
          <td>{{ t.scheduledDate }}</td>

          <td>
            <span
              class="badge"
              [ngClass]="{
                warn: t.status === 'PENDING',
                err: t.status === 'IN_PROGRESS',
                ok: t.status === 'COMPLETED'
              }"
            >
              {{ t.status }}
            </span>


            <span *ngIf="t.isEmergency" class="badge text-bg-danger btn-sm ms-2">EMERGENCY</span>

            <span *ngIf="t.isEmergency && t.dueAt" class="badge badge-sla">
              SLA: {{ timeLeft(t.dueAt) }}
            </span>
          </td>

          <td>
            <div style="display: flex; gap: 8px; flex-wrap: wrap">
              <button
                class="btn btn-primary"
                style="min-width: 90px"
                (click)="start(t.taskID)"
                [disabled]="t.status !== 'PENDING'"
              >
                Start
              </button>

              <button
                class="btn btn-primary"
                style="min-width: 90px"
                (click)="complete(t.taskID)"
                [disabled]="t.status !== 'IN_PROGRESS'"
              >
                Complete
              </button>


              <button
                class="btn btn-sm"
                [ngClass]="
                  t.status === 'COMPLETED'
                    ? 'btn-secondary'
                    : 'btn-outline-secondary'
                "
                style="min-width: 90px; text-align: center"
                [disabled]="t.status === 'COMPLETED'"
                (click)="onEdit(t.taskID)"
              >
                Edit
              </button>

              <button
                class="btn danger"
                style="min-width: 90px"
                (click)="remove(t.taskID)"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="tasks.length === 0">
          <td colspan="5" style="text-align: center; color: var(--muted)">
            No tasks found
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</table>
